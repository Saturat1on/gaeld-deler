<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>G√¶ld Deler üí∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding-top: 20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .input-group textarea {
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-danger {
            background: #ff4757;
            color: white;
            margin-top: 10px;
        }
        
        .summary-grid {
            display: grid;
            gap: 15px;
        }
        
        .summary-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
        }
        
        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .settlement {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .settlement-text {
            font-size: 1.1em;
            color: #333;
            line-height: 1.6;
        }
        
        .settlement-amount {
            color: #667eea;
            font-weight: bold;
        }
        
        .expense-list {
            margin-top: 20px;
        }
        
        .expense-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .expense-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .expense-amount {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }
        
        .expense-who {
            font-size: 0.9em;
            color: #666;
            margin-top: 3px;
        }
        
        .expense-desc {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .expense-delete {
            background: #ff4757;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
        }
        
        .person-manager {
            margin-bottom: 20px;
        }
        
        .person-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .person-tag {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        
        .person-tag button {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.8em;
            line-height: 1;
        }
        
        .add-person-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .add-person-form input {
            flex: 1;
        }
        
        .add-person-form button {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ G√¶ld Deler</h1>
            <p>Del udgifter nemt og fair</p>
        </div>

        <!-- Person Manager -->
        <div class="card person-manager">
            <h2 style="margin-bottom: 15px;">üë• Deltagere</h2>
            <div class="person-list" id="personList"></div>
            <div class="add-person-form">
                <input type="text" id="newPersonName" placeholder="Indtast navn..." maxlength="20">
                <button onclick="addPerson()">Tilf√∏j</button>
            </div>
        </div>

        <!-- Add Expense -->
        <div class="card">
            <h2 style="margin-bottom: 20px;">‚ûï Tilf√∏j Udgift</h2>
            
            <div class="input-group">
                <label>üíµ Bel√∏b (kr)</label>
                <input type="number" id="amount" placeholder="Indtast bel√∏b" step="0.01" min="0">
            </div>
            
            <div class="input-group">
                <label>üë§ Hvem betalte?</label>
                <select id="payer">
                    <option value="">V√¶lg person...</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>üìù Beskrivelse (valgfri)</label>
                <textarea id="description" placeholder="Hvad blev k√∏bt?"></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="addExpense()">Tilf√∏j Udgift</button>
        </div>

        <!-- Summary -->
        <div class="card">
            <h2 style="margin-bottom: 20px;">üìä Oversigt</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Total udgifter</div>
                    <div class="summary-value" id="totalExpenses">0 kr</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Per person</div>
                    <div class="summary-value" id="perPerson">0 kr</div>
                </div>
            </div>
            
            <div id="settlements" style="margin-top: 20px;"></div>
        </div>

        <!-- Expense List -->
        <div class="card">
            <h2 style="margin-bottom: 20px;">üìã Udgifter</h2>
            <div id="expenseList"></div>
            <button class="btn btn-danger" onclick="clearAll()" id="clearBtn" style="display: none;">Slet Alt</button>
        </div>
    </div>

    <script>
        // Data storage
        let persons = [];
        let expenses = [];

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('gaeldDelerData');
            if (saved) {
                const data = JSON.parse(saved);
                persons = data.persons || [];
                expenses = data.expenses || [];
            }
            updateDisplay();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('gaeldDelerData', JSON.stringify({ persons, expenses }));
        }

        // Add person
        function addPerson() {
            const input = document.getElementById('newPersonName');
            const name = input.value.trim();
            
            if (!name) {
                alert('Indtast et navn');
                return;
            }
            
            if (persons.includes(name)) {
                alert('Denne person findes allerede');
                return;
            }
            
            persons.push(name);
            input.value = '';
            saveData();
            updateDisplay();
        }

        // Remove person
        function removePerson(name) {
            const hasExpenses = expenses.some(exp => exp.payer === name);
            if (hasExpenses) {
                alert('Kan ikke slette - denne person har udgifter registreret');
                return;
            }
            
            if (confirm(`Slet ${name}?`)) {
                persons = persons.filter(p => p !== name);
                saveData();
                updateDisplay();
            }
        }

        // Update person list display
        function updatePersonList() {
            const listDiv = document.getElementById('personList');
            const payerSelect = document.getElementById('payer');
            
            if (persons.length === 0) {
                listDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üëÜ</div><p>Tilf√∏j deltagere ovenfor</p></div>';
                payerSelect.innerHTML = '<option value="">Tilf√∏j personer f√∏rst...</option>';
            } else {
                listDiv.innerHTML = persons.map(person => `
                    <div class="person-tag">
                        ${person}
                        <button onclick="removePerson('${person}')">√ó</button>
                    </div>
                `).join('');
                
                payerSelect.innerHTML = '<option value="">V√¶lg person...</option>' + 
                    persons.map(person => `<option value="${person}">${person}</option>`).join('');
            }
        }

        // Add expense
        function addExpense() {
            const amount = parseFloat(document.getElementById('amount').value);
            const payer = document.getElementById('payer').value;
            const description = document.getElementById('description').value.trim();
            
            if (!amount || amount <= 0) {
                alert('Indtast et gyldigt bel√∏b');
                return;
            }
            
            if (!payer) {
                alert('V√¶lg hvem der betalte');
                return;
            }
            
            const expense = {
                id: Date.now(),
                amount,
                payer,
                description,
                date: new Date().toLocaleDateString('da-DK')
            };
            
            expenses.push(expense);
            
            // Clear form
            document.getElementById('amount').value = '';
            document.getElementById('payer').value = '';
            document.getElementById('description').value = '';
            
            saveData();
            updateDisplay();
        }

        // Calculate settlements
        function calculateSettlements() {
            if (persons.length === 0 || expenses.length === 0) return [];
            
            const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const perPerson = total / persons.length;
            
            // Calculate balances
            const balances = {};
            persons.forEach(person => {
                balances[person] = -perPerson; // Everyone owes their share
            });
            
            expenses.forEach(exp => {
                balances[exp.payer] += exp.amount; // Payer gets credit
            });
            
            // Create settlements
            const settlements = [];
            const debtors = Object.entries(balances).filter(([_, bal]) => bal < -0.01).sort((a, b) => a[1] - b[1]);
            const creditors = Object.entries(balances).filter(([_, bal]) => bal > 0.01).sort((a, b) => b[1] - a[1]);
            
            let i = 0, j = 0;
            while (i < debtors.length && j < creditors.length) {
                const [debtor, debtAmount] = debtors[i];
                const [creditor, creditAmount] = creditors[j];
                
                const amount = Math.min(-debtAmount, creditAmount);
                
                settlements.push({
                    from: debtor,
                    to: creditor,
                    amount: amount
                });
                
                debtors[i][1] += amount;
                creditors[j][1] -= amount;
                
                if (Math.abs(debtors[i][1]) < 0.01) i++;
                if (Math.abs(creditors[j][1]) < 0.01) j++;
            }
            
            return settlements;
        }

        // Update all displays
        function updateDisplay() {
            updatePersonList();
            
            const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const perPerson = persons.length > 0 ? total / persons.length : 0;
            
            document.getElementById('totalExpenses').textContent = total.toFixed(2) + ' kr';
            document.getElementById('perPerson').textContent = perPerson.toFixed(2) + ' kr';
            
            // Settlements
            const settlements = calculateSettlements();
            const settlementsDiv = document.getElementById('settlements');
            
            if (settlements.length === 0) {
                settlementsDiv.innerHTML = '';
            } else {
                settlementsDiv.innerHTML = '<h3 style="margin-bottom: 15px;">üí∏ Afregninger</h3>' +
                    settlements.map(s => `
                        <div class="settlement">
                            <div class="settlement-text">
                                <strong>${s.from}</strong> skylder 
                                <strong>${s.to}</strong>: 
                                <span class="settlement-amount">${s.amount.toFixed(2)} kr</span>
                            </div>
                        </div>
                    `).join('');
            }
            
            // Expense list
            const listDiv = document.getElementById('expenseList');
            const clearBtn = document.getElementById('clearBtn');
            
            if (expenses.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>Ingen udgifter endnu</p>
                    </div>
                `;
                clearBtn.style.display = 'none';
            } else {
                listDiv.innerHTML = expenses.map(exp => `
                    <div class="expense-item">
                        <div class="expense-header">
                            <div>
                                <div class="expense-amount">${exp.amount.toFixed(2)} kr</div>
                                <div class="expense-who">Betalt af: ${exp.payer}</div>
                            </div>
                            <button class="expense-delete" onclick="deleteExpense(${exp.id})">Slet</button>
                        </div>
                        ${exp.description ? `<div class="expense-desc">${exp.description}</div>` : ''}
                        <div class="expense-desc">${exp.date}</div>
                    </div>
                `).reverse().join('');
                clearBtn.style.display = 'block';
            }
        }

        // Delete expense
        function deleteExpense(id) {
            if (confirm('Slet denne udgift?')) {
                expenses = expenses.filter(exp => exp.id !== id);
                saveData();
                updateDisplay();
            }
        }

        // Clear all
        function clearAll() {
            if (confirm('Slet ALLE udgifter? (Deltagere beholdes)')) {
                expenses = [];
                saveData();
                updateDisplay();
            }
        }

        // Allow Enter key to add person
        document.getElementById('newPersonName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPerson();
            }
        });

        // Load data on page load
        loadData();
    </script>
</body>
</html>

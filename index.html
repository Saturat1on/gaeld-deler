<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>G√¶ld Tracker üí∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .section-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #333;
        }
        
        .input-group {
            margin-bottom: 10px;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 10px;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            width: 100%;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .person-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }
        
        .person-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .person-info {
            flex: 1;
        }
        
        .person-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }
        
        .person-phone {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .edit-icon {
            background: #f39c12;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 10px;
        }
        
        .debt-amount {
            font-size: 1.5em;
            font-weight: 700;
            color: #e74c3c;
        }
        
        .debt-amount.zero {
            color: #27ae60;
        }
        
        .action-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-small {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .btn-add {
            background: #e74c3c;
            color: white;
        }
        
        .btn-subtract {
            background: #27ae60;
            color: white;
        }
        
        .btn-sms {
            background: #3498db;
            color: white;
        }
        
        .btn-delete {
            background: #95a5a6;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .transaction-list {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #e0e0e0;
            font-size: 0.9em;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            color: #999;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ G√¶ld Tracker</h1>
            <p>Hold styr p√• hvem der skylder dig penge</p>
        </div>

        <div class="card">
            <div class="section-title">üë§ Tilf√∏j Person</div>
            <div class="input-group">
                <input type="text" id="newPersonName" placeholder="Navn...">
                <input type="tel" id="newPersonPhone" placeholder="Telefonnummer...">
                <button class="btn" onclick="addPerson()">‚ûï Tilf√∏j</button>
            </div>
        </div>

        <div class="card">
            <div class="section-title">üìã Personer</div>
            <div id="peopleList" class="empty-state">Ingen personer endnu</div>
        </div>
    </div>

    <!-- Modal til bel√∏b -->
    <div id="amountModal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Indtast bel√∏b</div>
            <input type="number" id="modalAmount" placeholder="Bel√∏b (kr)" step="0.01">
            <input type="text" id="modalNote" placeholder="Note (valgfrit)">
            <button class="btn" onclick="confirmAmount()" style="margin-top: 10px;">‚úì Bekr√¶ft</button>
            <button class="btn" onclick="closeModal()" style="margin-top: 10px; background: #95a5a6;">‚úï Annuller</button>
        </div>
    </div>

    <!-- Modal til redigering -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">‚úèÔ∏è Rediger Person</div>
            <input type="text" id="editName" placeholder="Navn...">
            <input type="tel" id="editPhone" placeholder="Telefonnummer...">
            <button class="btn" onclick="confirmEdit()" style="margin-top: 10px;">‚úì Gem</button>
            <button class="btn" onclick="closeEditModal()" style="margin-top: 10px; background: #95a5a6;">‚úï Annuller</button>
        </div>
    </div>

    <script>
        let people = [];
        let currentAction = null;
        let editingPersonIndex = null;

        function loadData() {
            const saved = localStorage.getItem('debtTracker');
            if (saved) {
                people = JSON.parse(saved);
                renderPeople();
            }
        }

        function saveData() {
            localStorage.setItem('debtTracker', JSON.stringify(people));
        }

        function addPerson() {
            const name = document.getElementById('newPersonName').value.trim();
            const phone = document.getElementById('newPersonPhone').value.trim();
            
            if (!name) {
                alert('Indtast venligst et navn');
                return;
            }
            
            people.push({
                name: name,
                phone: phone,
                debt: 0,
                transactions: []
            });
            
            document.getElementById('newPersonName').value = '';
            document.getElementById('newPersonPhone').value = '';
            
            saveData();
            renderPeople();
        }

        function openEditModal(personIndex) {
            editingPersonIndex = personIndex;
            const person = people[personIndex];
            
            document.getElementById('editName').value = person.name;
            document.getElementById('editPhone').value = person.phone;
            document.getElementById('editModal').classList.add('active');
            document.getElementById('editName').focus();
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('editName').value = '';
            document.getElementById('editPhone').value = '';
            editingPersonIndex = null;
        }

        function confirmEdit() {
            const name = document.getElementById('editName').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            
            if (!name) {
                alert('Navn m√• ikke v√¶re tomt');
                return;
            }
            
            people[editingPersonIndex].name = name;
            people[editingPersonIndex].phone = phone;
            
            saveData();
            renderPeople();
            closeEditModal();
        }

        function openAmountModal(personIndex, type) {
            currentAction = { personIndex, type };
            document.getElementById('modalTitle').textContent = 
                type === 'add' ? '‚ûï Tilf√∏j G√¶ld' : 'üí≥ Registrer Betaling';
            document.getElementById('amountModal').classList.add('active');
            document.getElementById('modalAmount').focus();
        }

        function closeModal() {
            document.getElementById('amountModal').classList.remove('active');
            document.getElementById('modalAmount').value = '';
            document.getElementById('modalNote').value = '';
            currentAction = null;
        }

        function confirmAmount() {
            const amount = parseFloat(document.getElementById('modalAmount').value);
            const note = document.getElementById('modalNote').value.trim();
            
            if (!amount || amount <= 0) {
                alert('Indtast et gyldigt bel√∏b');
                return;
            }
            
            const { personIndex, type } = currentAction;
            const person = people[personIndex];
            
            if (type === 'add') {
                person.debt += amount;
            } else {
                person.debt -= amount;
            }
            
            person.transactions.push({
                type: type,
                amount: amount,
                note: note || (type === 'add' ? 'G√¶ld tilf√∏jet' : 'Betaling modtaget'),
                date: new Date().toLocaleDateString('da-DK')
            });
            
            saveData();
            renderPeople();
            closeModal();
        }

        function sendSMS(personIndex) {
            const person = people[personIndex];
            
            if (!person.phone) {
                alert('Intet telefonnummer registreret');
                return;
            }
            
            const message = `Hej ${person.name}! Du skylder mig ${person.debt.toFixed(2)} kr. Kan du betale via MobilePay eller p√• Revolut https://revolut.me/iamjc - hvis ikke du kan betale hele bel√∏bet kan du overf√∏re det du kan. Tak :-)`;
            
            window.location.href = `sms:${person.phone}?&body=${encodeURIComponent(message)}`;
        }

        function deletePerson(personIndex) {
            const person = people[personIndex];
            if (confirm(`Slet ${person.name}?`)) {
                people.splice(personIndex, 1);
                saveData();
                renderPeople();
            }
        }

        function renderPeople() {
            const container = document.getElementById('peopleList');
            
            if (people.length === 0) {
                container.innerHTML = '<div class="empty-state">Ingen personer endnu</div>';
                return;
            }
            
            container.innerHTML = people.map((person, index) => `
                <div class="person-card">
                    <div class="person-header">
                        <div class="person-info">
                            <div class="person-name">${person.name}</div>
                            ${person.phone ? `<div class="person-phone">üì± ${person.phone}</div>` : ''}
                        </div>
                        <button class="edit-icon" onclick="openEditModal(${index})" title="Rediger">‚úèÔ∏è</button>
                        <div class="debt-amount ${person.debt === 0 ? 'zero' : ''}">
                            ${person.debt.toFixed(2)} kr
                        </div>
                    </div>
                    
                    <div class="action-row">
                        <button class="btn-small btn-add" onclick="openAmountModal(${index}, 'add')">‚ûï Tilf√∏j G√¶ld</button>
                        <button class="btn-small btn-subtract" onclick="openAmountModal(${index}, 'subtract')">üí≥ Betaling</button>
                    </div>
                    
                    <div class="action-row">
                        <button class="btn-small btn-sms" onclick="sendSMS(${index})">üì± Send SMS</button>
                        <button class="btn-small btn-delete" onclick="deletePerson(${index})">üóëÔ∏è Slet</button>
                    </div>
                    
                    ${person.transactions.length > 0 ? `
                        <div class="transaction-list">
                            <strong>Historik:</strong>
                            ${person.transactions.slice(-3).reverse().map(t => `
                                <div class="transaction-item">
                                    <span>${t.date} - ${t.note}</span>
                                    <span style="color: ${t.type === 'add' ? '#e74c3c' : '#27ae60'}">
                                        ${t.type === 'add' ? '+' : '-'}${t.amount.toFixed(2)} kr
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Enter key support
        document.getElementById('newPersonName').addEventListener('keypress', e => {
            if (e.key === 'Enter') {
                document.getElementById('newPersonPhone').focus();
            }
        });
        
        document.getElementById('newPersonPhone').addEventListener('keypress', e => {
            if (e.key === 'Enter') addPerson();
        });
        
        document.getElementById('modalAmount').addEventListener('keypress', e => {
            if (e.key === 'Enter') confirmAmount();
        });

        document.getElementById('editName').addEventListener('keypress', e => {
            if (e.key === 'Enter') {
                document.getElementById('editPhone').focus();
            }
        });

        document.getElementById('editPhone').addEventListener('keypress', e => {
            if (e.key === 'Enter') confirmEdit();
        });

        // Luk modals ved klik udenfor
        document.getElementById('amountModal').addEventListener('click', e => {
            if (e.target.id === 'amountModal') closeModal();
        });

        document.getElementById('editModal').addEventListener('click', e => {
            if (e.target.id === 'editModal') closeEditModal();
        });

        // Load data ved start
        loadData();
    </script>
</body>
</html>
